
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://Eljily-Mohamed.github.io/project_emb_docs/SHT40%20SENSOR/">
      
      
        <link rel="prev" href="../IHM/">
      
      
        <link rel="next" href="../TCS3414CS%20SENSOR/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.26">
    
    
      
        <title>SHT40 SENSOR - My Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#sht40-sensor" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="My Docs" class="md-header__button md-logo" aria-label="My Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            My Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              SHT40 SENSOR
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
    
  
  Project Homepage

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../IHM/" class="md-tabs__link">
        
  
    
  
  IHM System Overview

      </a>
    </li>
  

      
        
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
    
  
  SHT40 SENSOR

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../TCS3414CS%20SENSOR/" class="md-tabs__link">
        
  
    
  
  TCS34725CS SENSOR

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../Test/" class="md-tabs__link">
        
  
    
  
  Test

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="My Docs" class="md-nav__button md-logo" aria-label="My Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    My Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Project Homepage
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../IHM/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IHM System Overview
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    SHT40 SENSOR
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    SHT40 SENSOR
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#hardware-components" class="md-nav__link">
    <span class="md-ellipsis">
      Hardware Components
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Hardware Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#microcontroller-development-kit" class="md-nav__link">
    <span class="md-ellipsis">
      Microcontroller Development Kit
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#software-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Software Implementation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#project-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Project Structure
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#essential-functions-for-sensor-communication" class="md-nav__link">
    <span class="md-ellipsis">
      Essential Functions for Sensor Communication
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-details-about-the-sht40-sensor" class="md-nav__link">
    <span class="md-ellipsis">
      Key Details about the SHT40 Sensor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Key Details about the SHT40 Sensor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#i2c-communication" class="md-nav__link">
    <span class="md-ellipsis">
      I2C Communication:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-type-length" class="md-nav__link">
    <span class="md-ellipsis">
      Data Type &amp; Length:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checksum-calculation" class="md-nav__link">
    <span class="md-ellipsis">
      Checksum Calculation:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#command-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Command Overview:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sensor-initialization" class="md-nav__link">
    <span class="md-ellipsis">
      Sensor Initialization
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-one" class="md-nav__link">
    <span class="md-ellipsis">
      Task One
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Task One">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#function-explanation" class="md-nav__link">
    <span class="md-ellipsis">
      Function Explanation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#here-is-an-image-explaining-the-process" class="md-nav__link">
    <span class="md-ellipsis">
      Here is an image explaining the process:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-two" class="md-nav__link">
    <span class="md-ellipsis">
      Task Two
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../TCS3414CS%20SENSOR/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TCS34725CS SENSOR
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Test/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Test
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#hardware-components" class="md-nav__link">
    <span class="md-ellipsis">
      Hardware Components
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Hardware Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#microcontroller-development-kit" class="md-nav__link">
    <span class="md-ellipsis">
      Microcontroller Development Kit
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#software-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Software Implementation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#project-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Project Structure
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#essential-functions-for-sensor-communication" class="md-nav__link">
    <span class="md-ellipsis">
      Essential Functions for Sensor Communication
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-details-about-the-sht40-sensor" class="md-nav__link">
    <span class="md-ellipsis">
      Key Details about the SHT40 Sensor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Key Details about the SHT40 Sensor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#i2c-communication" class="md-nav__link">
    <span class="md-ellipsis">
      I2C Communication:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-type-length" class="md-nav__link">
    <span class="md-ellipsis">
      Data Type &amp; Length:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checksum-calculation" class="md-nav__link">
    <span class="md-ellipsis">
      Checksum Calculation:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#command-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Command Overview:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sensor-initialization" class="md-nav__link">
    <span class="md-ellipsis">
      Sensor Initialization
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-one" class="md-nav__link">
    <span class="md-ellipsis">
      Task One
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Task One">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#function-explanation" class="md-nav__link">
    <span class="md-ellipsis">
      Function Explanation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#here-is-an-image-explaining-the-process" class="md-nav__link">
    <span class="md-ellipsis">
      Here is an image explaining the process:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-two" class="md-nav__link">
    <span class="md-ellipsis">
      Task Two
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="sht40-sensor">SHT40 SENSOR<a class="headerlink" href="#sht40-sensor" title="Permanent link">&para;</a></h1>
<p><img src="/images/grove_sht40.jpeg" alt="Grove SHT40" width="400"></br>
This section provides a detailed explanation of the embedded system aspect of our project, focusing specifically on the Grove SHT40 Temperature and Humidity Sensor.</p>
<h2 id="hardware-components">Hardware Components<a class="headerlink" href="#hardware-components" title="Permanent link">&para;</a></h2>
<h4 id="microcontroller-development-kit">Microcontroller Development Kit<a class="headerlink" href="#microcontroller-development-kit" title="Permanent link">&para;</a></h4>
<p>We utilize an STM32 microcontroller development kit to build and debug code for the card. This development kit, provided by the ENIB internal pack we use in our course (<a href="https://git.enib.fr/bald/mip_install/-/tree/main/fichiers?ref_type=heads">SDK pack</a>), allows us to efficiently develop and debug firmware for the embedded system.</p>
<h2 id="software-implementation">Software Implementation<a class="headerlink" href="#software-implementation" title="Permanent link">&para;</a></h2>
<p>Before we can utilize the SHT40 sensor, it's crucial to establish communication with it using the I2C protocol and configure it with the appropriate settings. To achieve this, we need to implement basic functions that facilitate communication with the sensor. These functions serve as the foundation for all subsequent interactions with the sensor. </p>
<h2 id="project-structure">Project Structure<a class="headerlink" href="#project-structure" title="Permanent link">&para;</a></h2>
<p>To integrate the SHT40 sensor into our project, you'll need to follow these steps:</p>
<ol>
<li>Create the necessary files:</li>
<li><code>sht40.h</code>: Header file for SHT40 sensor interface.</li>
<li><code>sht40.c</code>: Source file for SHT40 sensor implementation.</li>
</ol>
<h2 id="essential-functions-for-sensor-communication">Essential Functions for Sensor Communication<a class="headerlink" href="#essential-functions-for-sensor-communication" title="Permanent link">&para;</a></h2>
<p>To interact with the SHT40 sensor, we implement the following fundamental functions:</p>
<ol>
<li><strong><code>sht4x_write(uint8_t reg, uint8_t value)</code>:</strong> This function writes a single byte of data to a specified register of the sensor..</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">int16_t</span><span class="w"> </span><span class="nf">sht4x_write</span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">reg</span><span class="p">,</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="w">        </span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reg</span><span class="p">;</span>
<span class="w">        </span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xFF</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">i2c_write</span><span class="p">(</span><span class="n">I2C1</span><span class="p">,</span><span class="w"> </span><span class="n">SHT4X_ADDRESS</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">data</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>
<ol>
<li><strong><code>read(uint8_t reg , int delay)</code>:</strong> This function reads a single byte of data from a specified register of the sensor.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="nf">sht4x_read</span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">reg</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">delay</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="w">        </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">reg_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">reg</span><span class="p">};</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i2c_write</span><span class="p">(</span><span class="n">I2C1</span><span class="p">,</span><span class="w"> </span><span class="n">SHT4X_ADDRESS</span><span class="p">,</span><span class="w"> </span><span class="n">reg_data</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">I2C_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">uart_puts</span><span class="p">(</span><span class="n">_USART2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n\r</span><span class="s">Erreur lors de l&#39;écriture dans le registre</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">delay_us</span><span class="p">(</span><span class="n">delay</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i2c_read</span><span class="p">(</span><span class="n">I2C1</span><span class="p">,</span><span class="w"> </span><span class="n">SHT4X_ADDRESS</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">I2C_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">uart_puts</span><span class="p">(</span><span class="n">_USART2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n\r</span><span class="s">Erreur lors de la lecture d&#39;octets</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>
<ol>
<li><strong><code>write_n(uint8_t reg, uint8_t* values, uint8_t length)</code>:</strong> This function writes multiple bytes of data to consecutive registers of the sensor.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">int16_t</span><span class="w"> </span><span class="nf">sht4x_write_n</span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">reg</span><span class="p">,</span><span class="w"> </span><span class="kt">uint8_t</span><span class="o">*</span><span class="w"> </span><span class="n">values</span><span class="p">,</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">length</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<span class="w">        </span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reg</span><span class="p">;</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">i2c_write</span><span class="p">(</span><span class="n">I2C1</span><span class="p">,</span><span class="w"> </span><span class="n">SHT4X_ADDRESS</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">data</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>
<ol>
<li><strong><code>read_n(uint8_t reg, uint8_t* values, uint8_t length, int delay)</code>:</strong> This function reads multiple bytes of data from consecutive registers of the sensor.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">read_n</span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">reg</span><span class="p">,</span><span class="w"> </span><span class="kt">uint8_t</span><span class="o">*</span><span class="w"> </span><span class="n">values</span><span class="p">,</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">delay</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">reg_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">reg</span><span class="p">};</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i2c_write</span><span class="p">(</span><span class="n">I2C1</span><span class="p">,</span><span class="w"> </span><span class="n">SHT4X_ADDRESS</span><span class="p">,</span><span class="w"> </span><span class="n">reg_data</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">I2C_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">uart_puts</span><span class="p">(</span><span class="n">_USART2</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n\r</span><span class="s">Erreur lors de l&#39;écriture dans le registre</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">I2C_ERROR</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">delay_us</span><span class="p">(</span><span class="n">delay</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i2c_read</span><span class="p">(</span><span class="n">I2C1</span><span class="p">,</span><span class="w"> </span><span class="n">SHT4X_ADDRESS</span><span class="p">,</span><span class="w"> </span><span class="n">values</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">I2C_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">uart_puts</span><span class="p">(</span><span class="n">_USART2</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n\r</span><span class="s">Erreur lors de la lecture d&#39;octets</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>
<ol>
<li><strong><code>sht4x_write_cmd(const uint8_t* cmd)</code>:</strong> This function writes a command to the sensor.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">int16_t</span><span class="w"> </span><span class="nf">sht4x_write_cmd</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="o">*</span><span class="w"> </span><span class="n">cmd</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">i2c_write</span><span class="p">(</span><span class="n">I2C1</span><span class="p">,</span><span class="w"> </span><span class="n">SHT4X_ADDRESS</span><span class="p">,</span><span class="w"> </span><span class="n">cmd</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>
<ol>
<li><strong><code>sht4x_write_cmd(const uint8_t* cmd)</code>:</strong> This function writes a command to the sensor.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">int16_t</span><span class="w"> </span><span class="nf">sht4x_write_cmd</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="o">*</span><span class="w"> </span><span class="n">cmd</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">i2c_write</span><span class="p">(</span><span class="n">I2C1</span><span class="p">,</span><span class="w"> </span><span class="n">SHT4X_ADDRESS</span><span class="p">,</span><span class="w"> </span><span class="n">cmd</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>
<p>These functions provide the necessary groundwork for interacting with the SHT40 sensor via the I2C protocol. Once implemented, we can proceed with initializing the sensor and configuring it according to our project requirements.</p>
<h2 id="key-details-about-the-sht40-sensor">Key Details about the SHT40 Sensor<a class="headerlink" href="#key-details-about-the-sht40-sensor" title="Permanent link">&para;</a></h2>
<h4 id="i2c-communication">I2C Communication:<a class="headerlink" href="#i2c-communication" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Specification:</strong> Based on NXP’s I2C-bus specification.</li>
<li><strong>Supported Modes:</strong> Standard, fast mode, and fast mode plus.</li>
<li><strong>Data Transfer:</strong> Transferred in multiples of 16-bit words with an 8-bit checksum (CRC).</li>
<li><strong>Addressing:</strong> 7-bit I2C address followed by an eighth bit, denoting communication direction.</li>
<li><strong>Documentation:</strong> <a href="https://wiki.seeedstudio.com/Grove-SHT4x/">SHT40 Documentation</a></li>
</ul>
<h4 id="data-type-length">Data Type &amp; Length:<a class="headerlink" href="#data-type-length" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Operates with:</strong> 8-bit data packages.</li>
<li><strong>Checksum:</strong> Included after every second 8-bit data package.</li>
<li><strong>Transmission:</strong> Humidity and temperature data transmitted in a specific format.</li>
</ul>
<h4 id="checksum-calculation">Checksum Calculation:<a class="headerlink" href="#checksum-calculation" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>For Read Transfers:</strong> Each 16-bit data is followed by a checksum using CRC-8 algorithm.</li>
</ul>
<h4 id="command-overview">Command Overview:<a class="headerlink" href="#command-overview" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Various Commands:</strong> Available for different operations like measuring temperature and humidity, reading serial number, etc.</li>
</ul>
<p>Refer to the <a href="https://wiki.seeedstudio.com/Grove-SHT4x/">documentation</a> for detailed specifications and usage instructions.</p>
<h2 id="sensor-initialization">Sensor Initialization<a class="headerlink" href="#sensor-initialization" title="Permanent link">&para;</a></h2>
<p>To use the SHT40 sensor, we need to initialize the I2C communication and configure the sensor. For initialization, we first read the serial number to ensure that the sensor is connected and functioning properly. The process involves detecting if a sensor is connected by reading out the ID register. If the sensor does not answer or if the answer is not the expected value, the test fails.</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * Detects if a sensor is connected by reading out the ID register. If the sensor does not answer</span>
<span class="cm"> * or if the answer is not the expected value, the test fails.</span>
<span class="cm"> *</span>
<span class="cm"> * @return 0 if a sensor was detected</span>
<span class="cm"> */</span>
<span class="kt">int16_t</span><span class="w"> </span><span class="nf">sht4x_probe</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="kt">int16_t</span><span class="w"> </span><span class="nf">sht4x_probe</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">serial</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">sht4x_read_serial</span><span class="p">(</span><span class="o">&amp;</span><span class="n">serial</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// Internal function to retrieve the number of words divided by the word size (2 bytes)</span>
<span class="cp">#define SENSIRION_WORD_SIZE 2</span>
<span class="cp">#define SENSIRION_NUM_WORDS(x) (sizeof(x) / SENSIRION_WORD_SIZE)</span>

<span class="c1">// Duration necessary to write command</span>
<span class="cp">#define SHT4X_CMD_DURATION_USEC </span>

<span class="kt">int16_t</span><span class="w"> </span><span class="nf">sht4x_read_serial</span><span class="p">(</span><span class="kt">uint32_t</span><span class="o">*</span><span class="w"> </span><span class="n">serial</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SHT4X_CMD_READ_SERIAL</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int16_t</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">serial_words</span><span class="p">[</span><span class="n">SENSIRION_NUM_WORDS</span><span class="p">(</span><span class="o">*</span><span class="n">serial</span><span class="p">)];</span>
<span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">write_cmd</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sht4x_cmd_measure</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span>
<span class="w">    </span><span class="n">read_n</span><span class="p">((</span><span class="kt">uint8_t</span><span class="o">*</span><span class="p">)</span><span class="n">serial_words</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">serial_words</span><span class="p">));</span>
<span class="w">    </span><span class="o">*</span><span class="n">serial</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="kt">uint32_t</span><span class="p">)</span><span class="n">serial_words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">serial_words</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">I2C_OK</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="task-one">Task One<a class="headerlink" href="#task-one" title="Permanent link">&para;</a></h2>
<p>After initialization, we can now retrieve the temperature and humidity data. To do this, we need to create a function that allows us to read the temperature and humidity. Below is the function we developed:</p>
<div class="highlight"><pre><span></span><code><span class="kt">int16_t</span><span class="w"> </span><span class="nf">sht4x_measure_blocking_read</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">temperature</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">humidity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int16_t</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span>
<span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">write_cmd</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sht4x_cmd_measure</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span>
<span class="w">    </span><span class="n">delay_us</span><span class="p">(</span><span class="n">sht4x_cmd_measure_delay_us</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">sht4x_read_measurement</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span><span class="w"> </span><span class="n">humidity</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="function-explanation">Function Explanation<a class="headerlink" href="#function-explanation" title="Permanent link">&para;</a></h4>
<p>To read the temperature, we start by writing a command. After this, we can read the data. Similar to other sensors where a register pointer is used, we first send a write header to the I2C slave followed by a command. For example, "measure RH&amp;T with highest precision." After the measurement is finished, the read request directed to the I2C slave will be acknowledged, and the transmission of data will be started by the slave.</p>
<h4 id="here-is-an-image-explaining-the-process">Here is an image explaining the process:<a class="headerlink" href="#here-is-an-image-explaining-the-process" title="Permanent link">&para;</a></h4>
<p><img src="/images/write.png" alt="Grove SHT40" width="1000"></p>
<p>After sending the command, we can read the temperature and humidity. We need to use a formula to convert each value correctly. Refer to the documentation <a href="https://wiki.seeedstudio.com/Grove-SHT4x/">SHT40 Documentation</a> for more details.</p>
<div class="highlight"><pre><span></span><code><span class="kt">int16_t</span><span class="w"> </span><span class="nf">sht4x_read_measurement</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">temperature</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">humidity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">rawTemp</span><span class="p">,</span><span class="w"> </span><span class="n">rawHumd</span><span class="p">;</span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">words</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="w">    </span><span class="kt">int16_t</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read_n</span><span class="p">(</span><span class="n">words</span><span class="p">,</span><span class="n">SENSIRION_NUM_WORDS</span><span class="p">(</span><span class="n">words</span><span class="p">));</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * formulas for conversion of the sensor signals, optimized for fixed point</span>
<span class="cm">     * algebra:</span>
<span class="cm">     * Temperature = 175 * S_T / 65535 - 45</span>
<span class="cm">     * Relative Humidity = 125 * (S_RH / 65535) - 6</span>
<span class="cm">     */</span>

<span class="w">    </span><span class="n">rawTemp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="kt">uint16_t</span><span class="p">)</span><span class="w"> </span><span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="w">    </span><span class="n">rawHumd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="kt">uint16_t</span><span class="p">)</span><span class="w"> </span><span class="n">words</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">words</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>

<span class="w">    </span><span class="o">*</span><span class="n">temperature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">-45.0f</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">175.0f</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">rawTemp</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">65535.0f</span><span class="p">));</span>
<span class="w">    </span><span class="o">*</span><span class="n">humidity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">-6.0f</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">125.0f</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">rawHumd</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">65535.0f</span><span class="p">));</span><span class="w"> </span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="task-two">Task Two<a class="headerlink" href="#task-two" title="Permanent link">&para;</a></h2>
<p>Great, now we can test if this works well. We need to use serial UART ST-LINK to display the current temperature and humidity in the terminal. Here is a test where we define main.c. We will do the first test by adding some code to transform a float into two parts: the integer part and the decimal part.</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;libshield/sht4x.h&quot;</span>
<span class="cp">#define delay_us(us)        timer_wait_us(_TIM3, us)</span>


<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">on_command_received</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">uart_init</span><span class="p">(</span><span class="n">_USART2</span><span class="p">,</span><span class="w"> </span><span class="mi">115200</span><span class="p">,</span><span class="w"> </span><span class="n">UART_8N1</span><span class="p">,</span><span class="w"> </span><span class="n">on_command_received</span><span class="p">);</span>
<span class="w">    </span><span class="n">i2c_master_init</span><span class="p">(</span><span class="n">_I2C1</span><span class="p">);</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">sht4x_probe</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">uart_printf</span><span class="p">(</span><span class="n">UART_TO_USE</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SHT sensor probing failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">delay_us</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span><span class="w">  </span><span class="c1">// Sleep 1s</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kt">float</span><span class="w"> </span><span class="n">temperature</span><span class="p">,</span><span class="w"> </span><span class="n">humidity</span><span class="p">;</span>
<span class="w">                </span><span class="kt">int8_t</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sht4x_measure_blocking_read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">temperature</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">humidity</span><span class="p">);</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="kt">int</span><span class="w"> </span><span class="n">temp_int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="n">temperature</span><span class="p">;</span>
<span class="w">                    </span><span class="kt">float</span><span class="w"> </span><span class="n">temp_frac</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temperature</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">temp_int</span><span class="p">;</span>
<span class="w">                    </span><span class="kt">int</span><span class="w"> </span><span class="n">hum_int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="n">humidity</span><span class="p">;</span>
<span class="w">                    </span><span class="kt">float</span><span class="w"> </span><span class="n">hum_frac</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">humidity</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hum_int</span><span class="p">;</span>

<span class="w">                    </span><span class="kt">int</span><span class="w"> </span><span class="n">temp_int_frac</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">temp_frac</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span>
<span class="w">                    </span><span class="kt">int</span><span class="w"> </span><span class="n">hum_int_frac</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">hum_frac</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span>

<span class="w">                    </span><span class="n">uart_printf</span><span class="p">(</span><span class="n">UART_TO_USE</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\r\n</span><span class="s">temperature: %d.%d C&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">temp_int</span><span class="p">,</span><span class="w"> </span><span class="n">temp_int_frac</span><span class="p">);</span>
<span class="w">                    </span><span class="n">uart_printf</span><span class="p">(</span><span class="n">UART_TO_USE</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\r\n</span><span class="s">humidity: %d.%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">hum_int</span><span class="p">,</span><span class="w"> </span><span class="n">hum_int_frac</span><span class="p">);</span>

<span class="w">                    </span><span class="n">delay_us</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span><span class="w">  </span><span class="c1">// Sleep 1s</span>

<span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">uart_printf</span><span class="p">(</span><span class="n">UART_TO_USE</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\r\n</span><span class="s">Error reading measurement&quot;</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">&para;</a></h2>
<p>In this section, we include the essential details about the SHT40 sensor, its basic functionalities, and how to interface it with a microcontroller to read and display temperature and humidity values using UART. We also provide a sample code implementation for initializing the sensor, reading data, and handling errors. After this, we will add more extra features and improvements to enhance the functionality and reliability of the system.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.top", "header.autohide", "instant"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.ad660dcc.min.js"></script>
      
    
  </body>
</html>