
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://Eljily-Mohamed.github.io/project_emb_docs/TCS3414CS%20SENSOR/">
      
      
        <link rel="prev" href="../SHT40%20SENSOR/">
      
      
        <link rel="next" href="../Test/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.26">
    
    
      
        <title>TCS34725CS SENSOR - My Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tcs34725cs-sensor" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="My Docs" class="md-header__button md-logo" aria-label="My Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            My Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              TCS34725CS SENSOR
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
    
  
  Project Homepage

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../IHM/" class="md-tabs__link">
        
  
    
  
  IHM System Overview

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../SHT40%20SENSOR/" class="md-tabs__link">
        
  
    
  
  SHT40 SENSOR

      </a>
    </li>
  

      
        
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
    
  
  TCS34725CS SENSOR

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../Test/" class="md-tabs__link">
        
  
    
  
  Test

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="My Docs" class="md-nav__button md-logo" aria-label="My Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    My Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Project Homepage
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../IHM/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IHM System Overview
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SHT40%20SENSOR/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SHT40 SENSOR
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    TCS34725CS SENSOR
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    TCS34725CS SENSOR
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#hardware-components" class="md-nav__link">
    <span class="md-ellipsis">
      Hardware Components
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Hardware Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#microcontroller-development-kit" class="md-nav__link">
    <span class="md-ellipsis">
      Microcontroller Development Kit
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#software-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Software Implementation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#project-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Project Structure
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#essential-functions-for-sensor-communication" class="md-nav__link">
    <span class="md-ellipsis">
      Essential Functions for Sensor Communication
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Essential Functions for Sensor Communication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#command-bit" class="md-nav__link">
    <span class="md-ellipsis">
      Command Bit
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sensor-initialization" class="md-nav__link">
    <span class="md-ellipsis">
      Sensor Initialization
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-one" class="md-nav__link">
    <span class="md-ellipsis">
      Task One
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Task One">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reading-rgb-and-clear-values" class="md-nav__link">
    <span class="md-ellipsis">
      Reading RGB and Clear Values
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calculating-color-temperature" class="md-nav__link">
    <span class="md-ellipsis">
      Calculating Color Temperature
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calculating-illuminance-lux" class="md-nav__link">
    <span class="md-ellipsis">
      Calculating Illuminance (Lux)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-two" class="md-nav__link">
    <span class="md-ellipsis">
      Task Two
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Task Two">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing-color-and-illuminance-calculation" class="md-nav__link">
    <span class="md-ellipsis">
      Testing Color and Illuminance Calculation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing Color and Illuminance Calculation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-output" class="md-nav__link">
    <span class="md-ellipsis">
      Example Output
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verification" class="md-nav__link">
    <span class="md-ellipsis">
      Verification
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Test/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Test
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#hardware-components" class="md-nav__link">
    <span class="md-ellipsis">
      Hardware Components
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Hardware Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#microcontroller-development-kit" class="md-nav__link">
    <span class="md-ellipsis">
      Microcontroller Development Kit
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#software-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Software Implementation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#project-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Project Structure
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#essential-functions-for-sensor-communication" class="md-nav__link">
    <span class="md-ellipsis">
      Essential Functions for Sensor Communication
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Essential Functions for Sensor Communication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#command-bit" class="md-nav__link">
    <span class="md-ellipsis">
      Command Bit
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sensor-initialization" class="md-nav__link">
    <span class="md-ellipsis">
      Sensor Initialization
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-one" class="md-nav__link">
    <span class="md-ellipsis">
      Task One
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Task One">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reading-rgb-and-clear-values" class="md-nav__link">
    <span class="md-ellipsis">
      Reading RGB and Clear Values
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calculating-color-temperature" class="md-nav__link">
    <span class="md-ellipsis">
      Calculating Color Temperature
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calculating-illuminance-lux" class="md-nav__link">
    <span class="md-ellipsis">
      Calculating Illuminance (Lux)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-two" class="md-nav__link">
    <span class="md-ellipsis">
      Task Two
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Task Two">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing-color-and-illuminance-calculation" class="md-nav__link">
    <span class="md-ellipsis">
      Testing Color and Illuminance Calculation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing Color and Illuminance Calculation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-output" class="md-nav__link">
    <span class="md-ellipsis">
      Example Output
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verification" class="md-nav__link">
    <span class="md-ellipsis">
      Verification
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="tcs34725cs-sensor">TCS34725CS SENSOR<a class="headerlink" href="#tcs34725cs-sensor" title="Permanent link">&para;</a></h1>
<p><img src="/assests//images/tcs3414cs.jpg" alt="Grove TCS34725CS" width="400"></br>
This section provides a detailed explanation of the embedded system aspect of our project, focusing specifically on the Grove The TCS34725CS color sensor.</p>
<h2 id="hardware-components">Hardware Components<a class="headerlink" href="#hardware-components" title="Permanent link">&para;</a></h2>
<h4 id="microcontroller-development-kit">Microcontroller Development Kit<a class="headerlink" href="#microcontroller-development-kit" title="Permanent link">&para;</a></h4>
<p>We utilize an STM32 microcontroller development kit to build and debug code for the card. This development kit, provided by the ENIB internal pack we use in our course (<a href="https://git.enib.fr/bald/mip_install/-/tree/main/fichiers?ref_type=heads">SDK pack</a>), allows us to efficiently develop and debug firmware for the embedded system.</p>
<h2 id="software-implementation">Software Implementation<a class="headerlink" href="#software-implementation" title="Permanent link">&para;</a></h2>
<p>Before we can utilize the TCS34725CS sensor, it's crucial to establish communication with it using the I2C protocol and configure it with the appropriate settings. To achieve this, we need to implement basic functions that facilitate communication with the sensor. These functions serve as the foundation for all subsequent interactions with the sensor. </p>
<h2 id="project-structure">Project Structure<a class="headerlink" href="#project-structure" title="Permanent link">&para;</a></h2>
<p>To integrate the TCS34725CS sensor into our project, follow these steps:</p>
<ol>
<li>Create the necessary files:</li>
<li><code>TCS34725CS.h</code>: Header file for the TCS34725CS sensor interface.</li>
<li><code>TCS34725CS.c</code>: Source file for the TCS34725CS sensor implementation.</li>
</ol>
<h2 id="essential-functions-for-sensor-communication">Essential Functions for Sensor Communication<a class="headerlink" href="#essential-functions-for-sensor-communication" title="Permanent link">&para;</a></h2>
<p>To interact with the TCS34725CS sensor, we implement the following fundamental functions in addition to the basic functions previously discussed for the SHT40 sensor. One of these functions allows us to get a 16-bit value from the sensor:</p>
<div class="highlight"><pre><span></span><code><span class="kt">uint16_t</span><span class="w"> </span><span class="nf">read16</span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">reg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>

<span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">reg_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">TCS34725_COMMAND_BIT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">reg</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i2c_write</span><span class="p">(</span><span class="n">I2C1</span><span class="p">,</span><span class="w"> </span><span class="n">TCS34725_ADDRESS</span><span class="p">,</span><span class="w"> </span><span class="n">reg_data</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">I2C_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">uart_puts</span><span class="p">(</span><span class="n">_USART2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n\r</span><span class="s">Erreur lors de l&#39;écriture dans le registre</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i2c_read</span><span class="p">(</span><span class="n">I2C1</span><span class="p">,</span><span class="w"> </span><span class="n">TCS34725_ADDRESS</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">I2C_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">uart_puts</span><span class="p">(</span><span class="n">_USART2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n\r</span><span class="s">Erreur lors de la lecture d&#39;octets</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;&lt;=</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="command-bit">Command Bit<a class="headerlink" href="#command-bit" title="Permanent link">&para;</a></h3>
<p>The TCS34725_COMMAND_BIT is defined as 0x80. This bit is used to indicate that the following byte is a command for the TCS34725CS sensor. When interacting with the sensor, this bit is OR-ed with the register address to form the command byte.</p>
<h2 id="sensor-initialization">Sensor Initialization<a class="headerlink" href="#sensor-initialization" title="Permanent link">&para;</a></h2>
<p>To use the TCS34725CS sensor, we need to initialize the I2C communication and configure the sensor. For initialization, we first read the serial number to ensure that the sensor is connected and functioning properly. The process involves detecting if a sensor is connected by reading out the ID register. If the sensor does not answer or if the answer is not the expected value, the test fails.</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">tcs34725_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Initialize I2C communication on I2C1</span>
<span class="w">    </span><span class="c1">// Check if the initialization was successful</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i2c_master_init</span><span class="p">(</span><span class="n">I2C1</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">I2C_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// If I2C initialization fails, print an error message to the UART</span>
<span class="w">        </span><span class="n">uart_puts</span><span class="p">(</span><span class="n">_USART2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n\r</span><span class="s">Erreur: Communication I2C non initialisée</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w"> </span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Read the ID register of the TCS34725 sensor</span>
<span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read8</span><span class="p">(</span><span class="n">TCS34725_ID</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Check if the ID matches the expected values (0x44 or 0x10)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">id</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mh">0x44</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mh">0x10</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// If the ID does not match, print an error message to the UART</span>
<span class="w">        </span><span class="n">uart_puts</span><span class="p">(</span><span class="n">_USART2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n\r</span><span class="s">Erreur: ID Incorrect</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w"> </span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Define the configuration for the TCS34725 sensor</span>
<span class="w">    </span><span class="n">tcs34725_config_t</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="p">.</span><span class="n">enable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TCS34725_ENABLE_PON</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">TCS34725_ENABLE_AEN</span><span class="p">,</span><span class="w"> </span><span class="c1">// Enable the power-on and ADC</span>
<span class="w">        </span><span class="p">.</span><span class="n">integration_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TCS34725_INTEGRATIONTIME_700MS</span><span class="p">,</span><span class="w"> </span><span class="c1">// Set the integration time to 700ms</span>
<span class="w">        </span><span class="p">.</span><span class="n">gain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TCS34725_GAIN_1X</span><span class="w"> </span><span class="c1">// Set the gain to 1x</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="c1">// Write the configuration settings to the sensor</span>
<span class="w">    </span><span class="n">write8</span><span class="p">(</span><span class="n">TCS34725_ENABLE</span><span class="p">,</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="n">enable</span><span class="p">);</span><span class="w"> </span><span class="c1">// Enable the sensor</span>
<span class="w">    </span><span class="n">write8</span><span class="p">(</span><span class="n">TCS34725_ATIME</span><span class="p">,</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="n">integration_time</span><span class="p">);</span><span class="w"> </span><span class="c1">// Set the integration time</span>
<span class="w">    </span><span class="n">write8</span><span class="p">(</span><span class="n">TCS34725_CONTROL</span><span class="p">,</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="n">gain</span><span class="p">);</span><span class="w"> </span><span class="c1">// Set the gain</span>

<span class="w">    </span><span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="task-one">Task One<a class="headerlink" href="#task-one" title="Permanent link">&para;</a></h2>
<h3 id="reading-rgb-and-clear-values">Reading RGB and Clear Values<a class="headerlink" href="#reading-rgb-and-clear-values" title="Permanent link">&para;</a></h3>
<p>After the initialization is complete, we need to develop a function to retrieve the RGB and clear values from the sensor. Here is the function to do this:</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * @brief Reads the RGB and clear values from the TCS34725 sensor.</span>
<span class="cm"> *</span>
<span class="cm"> * This function reads the clear, red, green, and blue data from their respective</span>
<span class="cm"> * data registers. It also waits for the appropriate integration time to ensure</span>
<span class="cm"> * the data is ready before reading.</span>
<span class="cm"> *</span>
<span class="cm"> * @param red Pointer to store the red value.</span>
<span class="cm"> * @param green Pointer to store the green value.</span>
<span class="cm"> * @param blue Pointer to store the blue value.</span>
<span class="cm"> * @param clear Pointer to store the clear value.</span>
<span class="cm"> */</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">tcs34725_read_color</span><span class="p">(</span><span class="kt">uint16_t</span><span class="w"> </span><span class="o">*</span><span class="n">red</span><span class="p">,</span><span class="w"> </span><span class="kt">uint16_t</span><span class="w"> </span><span class="o">*</span><span class="n">green</span><span class="p">,</span><span class="w"> </span><span class="kt">uint16_t</span><span class="w"> </span><span class="o">*</span><span class="n">blue</span><span class="p">,</span><span class="w"> </span><span class="kt">uint16_t</span><span class="w"> </span><span class="o">*</span><span class="n">clear</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Read the clear, red, green, and blue data from their respective data registers</span>
<span class="w">    </span><span class="o">*</span><span class="n">clear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read16</span><span class="p">(</span><span class="n">TCS34725_CDATAL</span><span class="p">);</span>
<span class="w">    </span><span class="o">*</span><span class="n">red</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read16</span><span class="p">(</span><span class="n">TCS34725_RDATAL</span><span class="p">);</span>
<span class="w">    </span><span class="o">*</span><span class="n">green</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read16</span><span class="p">(</span><span class="n">TCS34725_GDATAL</span><span class="p">);</span>
<span class="w">    </span><span class="o">*</span><span class="n">blue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read16</span><span class="p">(</span><span class="n">TCS34725_BDATAL</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Read the integration time register</span>
<span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">atime_reg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read8</span><span class="p">(</span><span class="n">TCS34725_ATIME</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Calculate the integration time in milliseconds</span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">integration_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">256</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">atime_reg</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2.4</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Wait for the integration time to ensure data is ready</span>
<span class="w">    </span><span class="c1">// Note: The delay_us function is assumed to be available for microsecond delays</span>
<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">integration_time</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="c1">// 2.4 ms</span>
<span class="w">            </span><span class="n">delay_us</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span><span class="w"> </span><span class="c1">// Delay for 3 ms to ensure data is ready</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">24</span><span class="p">:</span><span class="w"> </span><span class="c1">// 24 ms</span>
<span class="w">            </span><span class="n">delay_us</span><span class="p">(</span><span class="mi">24000</span><span class="p">);</span><span class="w"> </span><span class="c1">// Delay for 24 ms to ensure data is ready</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">50</span><span class="p">:</span><span class="w"> </span><span class="c1">// 50 ms</span>
<span class="w">            </span><span class="n">delay_us</span><span class="p">(</span><span class="mi">50000</span><span class="p">);</span><span class="w"> </span><span class="c1">// Delay for 50 ms to ensure data is ready</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">101</span><span class="p">:</span><span class="w"> </span><span class="c1">// 101 ms</span>
<span class="w">            </span><span class="n">delay_us</span><span class="p">(</span><span class="mi">101000</span><span class="p">);</span><span class="w"> </span><span class="c1">// Delay for 101 ms to ensure data is ready</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">154</span><span class="p">:</span><span class="w"> </span><span class="c1">// 154 ms</span>
<span class="w">            </span><span class="n">delay_us</span><span class="p">(</span><span class="mi">154000</span><span class="p">);</span><span class="w"> </span><span class="c1">// Delay for 154 ms to ensure data is ready</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">700</span><span class="p">:</span><span class="w"> </span><span class="c1">// 700 ms</span>
<span class="w">            </span><span class="n">delay_us</span><span class="p">(</span><span class="mi">700000</span><span class="p">);</span><span class="w"> </span><span class="c1">// Delay for 700 ms to ensure data is ready</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="k">default</span><span class="o">:</span>
<span class="w">            </span><span class="c1">// If the integration time does not match any of the cases, no delay is needed</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>The switch-case statement uses the calculated integration time to delay the appropriate amount of time to ensure the data is ready. The delay_us function is assumed to be available to create delays in microseconds. The delay times are adjusted slightly to ensure proper timing.</p>
<h3 id="calculating-color-temperature">Calculating Color Temperature<a class="headerlink" href="#calculating-color-temperature" title="Permanent link">&para;</a></h3>
<p>After obtaining the RGB values, we can calculate the color temperature using the following function This function uses the RGB values to calculate the CIE 1931 XYZ color space values,and then computes the correlated color temperature (CCT) using the CIE 1931 xy chromaticity coordinates.</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * @brief Calculates the color temperature from the RGB values.</span>
<span class="cm"> * @param r Red value.</span>
<span class="cm"> * @param g Green value.</span>
<span class="cm"> * @param b Blue value.</span>
<span class="cm"> * @param x Pointer to store the x chromaticity coordinate.</span>
<span class="cm"> * @param y Pointer to store the y chromaticity coordinate.</span>
<span class="cm"> * @return The calculated color temperature in Kelvin.</span>
<span class="cm"> */</span>
<span class="kt">float</span><span class="w"> </span><span class="nf">calculateColorTemperature</span><span class="p">(</span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="o">*</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="o">*</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">Z</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">XYZ_sum</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Convert RGB values to CIE 1931 XYZ color space(The RGB values are converted to the CIE 1931 XYZ color space using the following equations)</span>
<span class="w">    </span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">-0.14282f</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1.54924f</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.95641f</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>
<span class="w">    </span><span class="n">Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">-0.32466f</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1.57837f</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.73191f</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>
<span class="w">    </span><span class="n">Z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">-0.68202f</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.77073f</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.56332f</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Sum of XYZ components</span>
<span class="w">    </span><span class="n">XYZ_sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Z</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">XYZ_sum</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Calculate the x and y chromaticity coordinates</span>
<span class="w">        </span><span class="o">*</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">XYZ_sum</span><span class="p">;</span>
<span class="w">        </span><span class="o">*</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Y</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">XYZ_sum</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Default values if XYZ_sum is zero</span>
<span class="w">        </span><span class="o">*</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.3320f</span><span class="p">;</span>
<span class="w">        </span><span class="o">*</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.1858f</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Calculate n value used in the CCT formula</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.3320f</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mf">0.1858f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">*</span><span class="n">y</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Calculate the correlated color temperature (CCT) using the CIE 1931 xy to CCT formula</span>
<span class="w">    </span><span class="c1">// CCT = 437*n^3 + 3601*n^2 + 6861*n + 5517</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">cct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="mi">437</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mi">3601</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mi">6861</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">5517</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">cct</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>For more information on the CIE 1931 xy to CCT formula, you can refer to this (<a href="https://www.waveformlighting.com/tech/calculate-color-temperature-cct-from-cie-1931-xy-coordinates">link</a>)</p>
<h3 id="calculating-illuminance-lux">Calculating Illuminance (Lux)<a class="headerlink" href="#calculating-illuminance-lux" title="Permanent link">&para;</a></h3>
<p>After obtaining the RGB values, we can calculate the illuminance (lux) using the following function:</p>
<div class="highlight"><pre><span></span><code><span class="cm">/**</span>
<span class="cm"> * @brief Calculates the illuminance (lux) from the RGB values.</span>
<span class="cm"> *</span>
<span class="cm"> * This function uses the RGB values to calculate the illuminance in lux based on</span>
<span class="cm"> * a weighted sum of the red, green, and blue components.</span>
<span class="cm"> *</span>
<span class="cm"> * @param r Red value.</span>
<span class="cm"> * @param g Green value.</span>
<span class="cm"> * @param b Blue value.</span>
<span class="cm"> * @return The calculated illuminance in lux.</span>
<span class="cm"> */</span>
<span class="kt">float</span><span class="w"> </span><span class="nf">calculateLux</span><span class="p">(</span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">illuminance</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Calculate illuminance using a weighted sum of the RGB values</span>
<span class="w">    </span><span class="c1">// The weights are derived from the spectral sensitivity of the sensor</span>
<span class="w">    </span><span class="n">illuminance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">-0.32466f</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mf">1.57837f</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">g</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mf">-0.73191f</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Return the calculated illuminance</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="kt">uint16_t</span><span class="p">)</span><span class="n">illuminance</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>By using this function, you can convert the RGB values obtained from the TCS34725 sensor into an illuminance value in lux, providing a measure of the light intensity.
For more detailed information on how illuminance is calculated from RGB values and the spectral sensitivity of the sensor, you can refer to relevant technical documentation and research papers on color sensing and photometry.</p>
<h2 id="task-two">Task Two<a class="headerlink" href="#task-two" title="Permanent link">&para;</a></h2>
<h3 id="testing-color-and-illuminance-calculation">Testing Color and Illuminance Calculation<a class="headerlink" href="#testing-color-and-illuminance-calculation" title="Permanent link">&para;</a></h3>
<p>Great, now we can test if this works well. We need to use serial UART ST-LINK to display x, y, lux, and color temperature in Kelvin in the terminal. Here is a test where we define <code>main.c</code>.</p>
<div class="highlight"><pre><span></span><code><span class="k">case</span><span class="w"> </span><span class="sc">&#39;c&#39;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="c1">// Get current color</span>
<span class="w">                </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">red</span><span class="p">,</span><span class="w"> </span><span class="n">green</span><span class="p">,</span><span class="w"> </span><span class="n">blue</span><span class="p">,</span><span class="w"> </span><span class="n">clear</span><span class="p">,</span><span class="w"> </span><span class="n">color_temp</span><span class="p">,</span><span class="w"> </span><span class="n">lux</span><span class="p">;</span>
<span class="w">                </span><span class="kt">float</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>

<span class="w">                </span><span class="n">tcs34725_read_color</span><span class="p">(</span><span class="o">&amp;</span><span class="n">red</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">green</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">blue</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">clear</span><span class="p">);</span>
<span class="w">                </span><span class="n">color_temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calculateColorTemperature</span><span class="p">(</span><span class="n">red</span><span class="p">,</span><span class="w"> </span><span class="n">green</span><span class="p">,</span><span class="w"> </span><span class="n">blue</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">y</span><span class="p">);</span>
<span class="w">                </span><span class="n">lux</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calculateLux</span><span class="p">(</span><span class="n">red</span><span class="p">,</span><span class="w"> </span><span class="n">green</span><span class="p">,</span><span class="w"> </span><span class="n">blue</span><span class="p">);</span>

<span class="w">                </span><span class="c1">// Convertir les coordonnées chromatiques en parties entières et décimales</span>
<span class="w">                </span><span class="kt">int</span><span class="w"> </span><span class="n">x_int</span><span class="w"> </span><span class="o">=</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">x</span><span class="p">;</span>
<span class="w">                </span><span class="kt">float</span><span class="w"> </span><span class="n">x_frac</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="o">-</span><span class="n">x_int</span><span class="p">;</span>
<span class="w">                </span><span class="kt">int</span><span class="w"> </span><span class="n">x_frac_int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">x_frac</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span>
<span class="w">                </span><span class="kt">int</span><span class="w"> </span><span class="n">y_int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">y</span><span class="p">;</span>
<span class="w">                </span><span class="kt">float</span><span class="w"> </span><span class="n">y_frac</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="o">-</span><span class="n">y_int</span><span class="p">;</span>
<span class="w">                </span><span class="kt">int</span><span class="w"> </span><span class="n">y_frac_int</span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">y_frac</span><span class="o">*</span><span class="mi">1000</span><span class="p">);</span>

<span class="w">                </span><span class="c1">// Afficher (x,y) avec illuminance (color + brightness  )</span>
<span class="w">                </span><span class="n">uart_printf</span><span class="p">(</span><span class="n">UART_TO_USE</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\r\n</span><span class="s">x = %d.%d , y=%d.%d, illuminance=%d</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x_int</span><span class="p">,</span><span class="w"> </span><span class="n">x_frac_int</span><span class="p">,</span><span class="w"> </span><span class="n">y_int</span><span class="p">,</span><span class="w"> </span><span class="n">y_frac_int</span><span class="p">,</span><span class="n">lux</span><span class="p">);</span>
<span class="w">                </span><span class="n">uart_printf</span><span class="p">(</span><span class="n">UART_TO_USE</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\r\n</span><span class="s">Temperature en Kelvin: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">color_temp</span><span class="p">);</span>

<span class="w">                </span><span class="n">timer_start</span><span class="p">(</span><span class="n">_TIM2</span><span class="p">);</span><span class="w">  </span><span class="c1">// Sleep 1s</span>
<span class="w">                </span><span class="cp">#endif</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
</code></pre></div>
<h4 id="example-output">Example Output<a class="headerlink" href="#example-output" title="Permanent link">&para;</a></h4>
<p>When the sensor detects color and calculates the values, the output in the terminal might look like this:</p>
<div class="highlight"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">x = 0.332, y = 0.185, illuminance = 123</span>
<span class="l l-Scalar l-Scalar-Plain">Temperature in Kelvin</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5500</span>
</code></pre></div>
<h4 id="verification">Verification<a class="headerlink" href="#verification" title="Permanent link">&para;</a></h4>
<p>We can verify if the x, y coordinates and the lux values are correct by using a CIE 1931 xy to CCT calculator. Here is an example showing the process:
<img src="/assests//images/test.png" alt="Grove TCS34725CS" width="400"></br></p>
<p>For more information on the CIE 1931 xy to CCT formula and how to use it, you can refer to this (<a href="https://www.waveformlighting.com/tech/calculate-color-temperature-cct-from-cie-1931-xy-coordinates">link</a>)</p>
<h2 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">&para;</a></h2>
<p>In this section, we include the essential details about the TCS34725CS sensor, its basic functionalities, and how to interface it with a microcontroller to read and display color temperature, chromaticity coordinates, and illuminance values using UART. We also provide a sample code implementation for initializing the sensor, reading data, and handling errors.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.top", "header.autohide", "instant"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.ad660dcc.min.js"></script>
      
    
  </body>
</html>